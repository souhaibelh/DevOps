stages:
  - build
  - test

spring-build-job:
  stage: build
  image: eclipse-temurin:17-jdk-alpine
  rules:
    - changes:
        - service-java/**/*
  script:
    - chmod +x ./service-java/mvnw
    - ./service-java/mvnw -f ./service-java/pom.xml compile

python-build-job:
  stage: build
  image: python:3.12-slim
  rules:
    - changes:
        - service-python/**/*
  cache:
    key: python-deps
    paths:
      - .venv/      
  script:
    - python -m venv .venv
    - source .venv/bin/activate
    - pip install -r ./service-python/requirements.txt
    - python -m compileall ./service-python

spring-test-job:
  stage: test
  image: eclipse-temurin:17-jdk-alpine
  rules:
    - changes:
        - service-java/**/*
  script:
    - chmod +x ./service-java/mvnw
    - ./service-java/mvnw -f ./service-java/pom.xml test

python-test-job:
  stage: test
  image: python:3.12-slim
  rules:
    - changes:
        - service-python/**/*
  cache:
    key: python-deps
    paths:
      - .venv/      
  script:
    - source .venv/bin/activate
    - pip install pytest
    - pytest ./service-python/test_app.py