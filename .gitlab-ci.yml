stages:
    build
    test

spring-build-job:
    stage: build
    image: maven:3.9.11-eclipse-temurin-17-alpine
    cache:
        key: "$CI_COMMIT_REF_SLUG-maven"
        paths: 
            - /root/.m2/repository       
    script:
        - mvn -f service-java/pom.xml compile

python-build-job:
    stage: build
    image: python:3.12-slim
    cache:
        key: "$CI_COMMIT_REF_SLUG-python"
        paths:
            - .venv/
    script:
        - python -m venv .venv
        - source .venv/bin/activate
        - pip install -r service-python/requirements.txt

spring-test-job:
    stage: test
    image: maven:3.9.11-eclipse-temurin-17-alpine
    cache:
        key: "$CI_COMMIT_REF_SLUG-maven"
        paths: 
            - /root/.m2/repository       
    script:
        - mvn -f service-java/pom.xml test

python-test-job:
  stage: test
  image: python:3.12-slim
  cache:
    key: "$CI_COMMIT_REF_SLUG-python"
    paths:
      - .venv/
  script:
    - source .venv/bin/activate
    - pip install pytest
    - pytest service-python/tests/     